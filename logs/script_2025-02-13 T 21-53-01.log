2025-02-13 21:53:08 - INFO - ****Starting Wind Turbine Data Pipeline...****

2025-02-13 21:53:08 - INFO - Starting: Database Setup
2025-02-13 21:53:08 - INFO - Wind Turbine - Databse Setup Starts 

2025-02-13 21:53:08 - INFO - Database 'wind_turbine_db' already exists.
2025-02-13 21:53:08 - INFO - get DB connection
2025-02-13 21:53:08 - INFO - Table - wind_turbine_raw_data is either exist or created successfully
2025-02-13 21:53:08 - INFO - Table - wind_turbine_ingestion_tracker is either exist or created successfully
2025-02-13 21:53:08 - INFO - Table - wind_turbine_clean_data is either exist or created successfully
2025-02-13 21:53:08 - INFO - Table - wind_turbine_anomalies is either exist or created successfully
2025-02-13 21:53:08 - INFO - Table - wind_turbine_mean_median_mode_stats is either exist or created successfully
2025-02-13 21:53:08 - INFO - Table - wind_turbine_summary_stats is either exist or created successfully
2025-02-13 21:53:08 - INFO - DB Connection closed.
2025-02-13 21:53:08 - INFO - DB mysql_connection closed.
2025-02-13 21:53:08 - INFO - Completed: Database Setup

2025-02-13 21:53:08 - INFO - Starting: Data Ingestion
2025-02-13 21:53:08 - INFO - Wind Turbine - Data ingestion Starts 

2025-02-13 21:53:08 - INFO - Step 1 - get DB connection
2025-02-13 21:53:08 - INFO - Step 2 - start ingesting CSVs
2025-02-13 21:53:08 - INFO - ingest_all_csvs function called....

2025-02-13 21:53:08 - INFO - CSV file: data_group_1.csv processing starts
2025-02-13 21:53:08 - INFO - ingest_csv function called....

2025-02-13 21:53:08 - INFO - get_last_processed_info function called....

2025-02-13 21:53:08 - INFO - SQL Query for get_last_processed_info - 
            SELECT last_record_timestamp, last_record_csv_row_number 
                FROM wind_turbine_ingestion_tracker 
                WHERE file_name = %s
            ORDER BY data_insertion_date DESC 
            LIMIT 1
            
2025-02-13 21:53:08 - INFO - Last record from previous load: (datetime.datetime(2022, 3, 31, 23, 0), 3720)
2025-02-13 21:53:08 - INFO - last_csv_processed_info: (datetime.datetime(2022, 3, 31, 23, 0), 3720)
2025-02-13 21:53:08 - INFO - Processing new data 120 new rows for data/raw_data\data_group_1.csv
2025-02-13 21:53:08 - INFO - Data load (120 records) for data/raw_data\data_group_1.csv is Successful
2025-02-13 21:53:08 - INFO - update_wind_turbine_ingestion_tracker function called....

2025-02-13 21:53:08 - INFO - SQL query for update_wind_turbine_ingestion_tracker: 
            INSERT INTO wind_turbine_ingestion_tracker (file_name, last_record_timestamp, last_record_csv_row_number)
            VALUES (%s, %s, %s)
            
2025-02-13 21:53:08 - INFO - Table wind_turbine_ingestion_tracker updated
2025-02-13 21:53:08 - INFO - move_csv_to_archive function called....

2025-02-13 21:53:08 - INFO - data/raw_data\data_group_1.csv moved to Archive folder
2025-02-13 21:53:08 - INFO - CSV file: data_group_1.csv processing ends
2025-02-13 21:53:08 - INFO - CSV file: data_group_2.csv processing starts
2025-02-13 21:53:08 - INFO - ingest_csv function called....

2025-02-13 21:53:08 - INFO - get_last_processed_info function called....

2025-02-13 21:53:08 - INFO - SQL Query for get_last_processed_info - 
            SELECT last_record_timestamp, last_record_csv_row_number 
                FROM wind_turbine_ingestion_tracker 
                WHERE file_name = %s
            ORDER BY data_insertion_date DESC 
            LIMIT 1
            
2025-02-13 21:53:08 - INFO - Last record from previous load: (datetime.datetime(2022, 3, 31, 23, 0), 3720)
2025-02-13 21:53:08 - INFO - last_csv_processed_info: (datetime.datetime(2022, 3, 31, 23, 0), 3720)
2025-02-13 21:53:08 - INFO - Processing new data 120 new rows for data/raw_data\data_group_2.csv
2025-02-13 21:53:08 - INFO - Data load (120 records) for data/raw_data\data_group_2.csv is Successful
2025-02-13 21:53:08 - INFO - update_wind_turbine_ingestion_tracker function called....

2025-02-13 21:53:08 - INFO - SQL query for update_wind_turbine_ingestion_tracker: 
            INSERT INTO wind_turbine_ingestion_tracker (file_name, last_record_timestamp, last_record_csv_row_number)
            VALUES (%s, %s, %s)
            
2025-02-13 21:53:08 - INFO - Table wind_turbine_ingestion_tracker updated
2025-02-13 21:53:08 - INFO - move_csv_to_archive function called....

2025-02-13 21:53:08 - INFO - data/raw_data\data_group_2.csv moved to Archive folder
2025-02-13 21:53:08 - INFO - CSV file: data_group_2.csv processing ends
2025-02-13 21:53:08 - INFO - CSV file: data_group_3.csv processing starts
2025-02-13 21:53:08 - INFO - ingest_csv function called....

2025-02-13 21:53:08 - INFO - get_last_processed_info function called....

2025-02-13 21:53:08 - INFO - SQL Query for get_last_processed_info - 
            SELECT last_record_timestamp, last_record_csv_row_number 
                FROM wind_turbine_ingestion_tracker 
                WHERE file_name = %s
            ORDER BY data_insertion_date DESC 
            LIMIT 1
            
2025-02-13 21:53:08 - INFO - Last record from previous load: (datetime.datetime(2022, 3, 31, 23, 0), 3720)
2025-02-13 21:53:08 - INFO - last_csv_processed_info: (datetime.datetime(2022, 3, 31, 23, 0), 3720)
2025-02-13 21:53:09 - INFO - Processing new data 120 new rows for data/raw_data\data_group_3.csv
2025-02-13 21:53:09 - INFO - Data load (120 records) for data/raw_data\data_group_3.csv is Successful
2025-02-13 21:53:09 - INFO - update_wind_turbine_ingestion_tracker function called....

2025-02-13 21:53:09 - INFO - SQL query for update_wind_turbine_ingestion_tracker: 
            INSERT INTO wind_turbine_ingestion_tracker (file_name, last_record_timestamp, last_record_csv_row_number)
            VALUES (%s, %s, %s)
            
2025-02-13 21:53:09 - INFO - Table wind_turbine_ingestion_tracker updated
2025-02-13 21:53:09 - INFO - move_csv_to_archive function called....

2025-02-13 21:53:09 - INFO - data/raw_data\data_group_3.csv moved to Archive folder
2025-02-13 21:53:09 - INFO - CSV file: data_group_3.csv processing ends
2025-02-13 21:53:09 - INFO - DB connection closed.
2025-02-13 21:53:09 - INFO - Completed: Data Ingestion

2025-02-13 21:53:09 - INFO - Starting: Data Cleaning
2025-02-13 21:53:09 - INFO - Wind Turbine - Data Cleaning Process Starts 

2025-02-13 21:53:09 - INFO - Step 1 - get DB connection
2025-02-13 21:53:09 - INFO - MySQL DB connection is successful.
2025-02-13 21:53:09 - INFO - Step 2 - Detect & Store anomalies
2025-02-13 21:53:09 - INFO - detect_and_store_anomalies function called....

2025-02-13 21:53:09 - INFO - get_max_timestamp_prev_run function called....

2025-02-13 21:53:09 - INFO - Using wind_turbine_clean_data to calculate AVG and STD values
2025-02-13 21:53:09 - INFO - mean_power: 3.0017671329298454
2025-02-13 21:53:09 - INFO - mean_power: 0.8699388594091308
2025-02-13 21:53:09 - INFO - lower_bound: 1.2618894141115837
2025-02-13 21:53:09 - INFO - upper_bound: 4.741644851748108
2025-02-13 21:53:09 - INFO - anomalies_table_row_count: 12
2025-02-13 21:53:09 - INFO - max_timestamp of previous clean data run: 2022-03-31 23:00:00
2025-02-13 21:53:09 - INFO - Using timestamp filter for anomalies data insertion: timestamp > max_timestamp
2025-02-13 21:53:09 - INFO - insert_anomalies_query: 
                    INSERT INTO wind_turbine_anomalies (timestamp, turbine_id, wind_speed, wind_direction, power_output)
                    SELECT timestamp, turbine_id, wind_speed, wind_direction, power_output
                        FROM wind_turbine_raw_data
                        WHERE power_output < %s OR power_output > %s and timestamp > %s
                        ON DUPLICATE KEY UPDATE 
                            wind_speed = VALUES(wind_speed),
                            wind_direction = VALUES(wind_direction),
                            power_output = VALUES(power_output),
                            insertion_date = CURRENT_TIMESTAMP;
                    
2025-02-13 21:53:09 - INFO - anomalies detected and stored successfully.
2025-02-13 21:53:09 - INFO - Step 3 - Process Statistics i.e. process and store stats for different period
2025-02-13 21:53:09 - INFO - process_stat function called....

2025-02-13 21:53:09 - INFO - get_max_timestamp_prev_run function called....

2025-02-13 21:53:09 - INFO - get_filtered_data function called....

2025-02-13 21:53:09 - INFO - period_start: None
2025-02-13 21:53:09 - INFO - calculate_statistics function called....

2025-02-13 21:53:09 - INFO - store_statistics function called....

2025-02-13 21:53:09 - INFO - get_filtered_data function called....

2025-02-13 21:53:09 - INFO - period_start: 2022-03-04 23:00:00
2025-02-13 21:53:09 - INFO - calculate_statistics function called....

2025-02-13 21:53:09 - INFO - store_statistics function called....

2025-02-13 21:53:09 - INFO - get_filtered_data function called....

2025-02-13 21:53:09 - INFO - period_start: 2022-03-18 23:00:00
2025-02-13 21:53:10 - INFO - calculate_statistics function called....

2025-02-13 21:53:10 - INFO - store_statistics function called....

2025-02-13 21:53:10 - INFO - get_filtered_data function called....

2025-02-13 21:53:10 - INFO - period_start: 2022-03-25 23:00:00
2025-02-13 21:53:10 - INFO - calculate_statistics function called....

2025-02-13 21:53:10 - INFO - store_statistics function called....

2025-02-13 21:53:10 - INFO - get_filtered_data function called....

2025-02-13 21:53:10 - INFO - period_start: 2022-03-31 23:00:00
2025-02-13 21:53:10 - INFO - calculate_statistics function called....

2025-02-13 21:53:10 - INFO - store_statistics function called....

2025-02-13 21:53:10 - INFO - Step 4 - Update clean data table for missing values
2025-02-13 21:53:10 - INFO - update_clean_table function called....

2025-02-13 21:53:10 - INFO - update_clean_table query: 
            INSERT IGNORE INTO wind_turbine_clean_data (timestamp, turbine_id, wind_speed, wind_direction, power_output)
            SELECT 
                timestamp, turbine_id, 
                COALESCE(wind_speed, (
                    SELECT wind_speed_median 
                    FROM wind_turbine_mean_median_mode_stats 
                    WHERE period= 'full_dataset'
                    ORDER BY calculation_timestamp DESC 
                    LIMIT 1
                    )),  
                COALESCE(wind_direction, (
                    SELECT wind_direction_median 
                    FROM wind_turbine_mean_median_mode_stats 
                    WHERE period= 'full_dataset'
                    ORDER BY calculation_timestamp DESC 
                    LIMIT 1
                    )),  
                COALESCE(power_output, (
                    SELECT power_output_mean 
                    FROM wind_turbine_mean_median_mode_stats 
                    WHERE period= 'full_dataset'
                    ORDER BY calculation_timestamp DESC 
                    LIMIT 1
                    ))     
            FROM wind_turbine_raw_data r
            WHERE NOT EXISTS (
                SELECT 1 FROM wind_turbine_anomalies o
                WHERE r.timestamp = o.timestamp
                AND r.turbine_id = o.turbine_id
            );
            
2025-02-13 21:53:11 - INFO - Clean data updated successfully
2025-02-13 21:53:11 - INFO - DB Connection closed.
2025-02-13 21:53:11 - INFO - Completed: Data Cleaning

2025-02-13 21:53:11 - INFO - Starting: Summary Statistics Calculation
2025-02-13 21:53:11 - INFO - Wind Turbine - calculate summary stats starts 

2025-02-13 21:53:11 - INFO - Step 1 - get DB connection
2025-02-13 21:53:11 - INFO - MySQL DB connection is successful.
2025-02-13 21:53:11 - INFO - Step 2 - calculate summary stats
2025-02-13 21:53:11 - INFO - calculate_summary_stats function called...

2025-02-13 21:53:12 - INFO - Summary statistics updated successfully.
2025-02-13 21:53:12 - INFO - calculate_summary_stats is successful
2025-02-13 21:53:12 - INFO - get_anomalies_summary_stats function called...

2025-02-13 21:53:12 - INFO - drop_and_create_summary_table function called....

2025-02-13 21:53:12 - INFO - generate_summary_stats_query function called....

2025-02-13 21:53:12 - INFO - Anomaly summary insertion successful.
2025-02-13 21:53:12 - INFO - get_anomalies_summary_stats is successful
2025-02-13 21:53:12 - INFO - DB Connection closed.
2025-02-13 21:53:12 - INFO - Completed: Summary Statistics Calculation

2025-02-13 21:53:12 - INFO - ****Wind Turbine Data Pipeline ran successfully...****
